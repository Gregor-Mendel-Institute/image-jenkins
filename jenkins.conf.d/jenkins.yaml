---
jenkins:
  systemMessage: |
    Jenkins configured automatically by Jenkins Configuration as Code plugin
  numExecutors: 5
  scmCheckoutRetryCount: 2
  mode: NORMAL
  globalNodeProperties:
    - envVars:
        env:
          - key: GLOBAL_JOB_DISABLE
            value: ${JENKINS_GLOBAL_JOB_DISABLE:-false}
  authorizationStrategy:
    #
    # role based:
    # https://github.com/jenkinsci/configuration-as-code-plugin/tree/master/demos/role-strategy-auth
    projectMatrix:
      permissions:
        # should be perm.* groups, but saml does not deliver domain local groups
        # see https://social.technet.microsoft.com/wiki/contents/articles/13829.ad-fs-2-0-domain-local-groups-in-a-claim.aspx
        - "Overall/Administer:jenkins_api_admin"
        - "Overall/Administer:adm_ebirn"
        - "Overall/Administer:role.it.backoffice.admin"
        - "Overall/Read:admin"
        - "Overall/Read:adm_ebirn"
        - "Overall/Read:authenticated"
        - "Job/ViewStatus:anonymous"   # make links to embeddable build status work
        - "Job/Discover:role.it.backoffice"
        - "Job/Read:role.it.backoffice"
        - "Job/Build:role.it.backoffice"
        - "Job/Cancel:role.it.backoffice"
        - "Agent/Build:anonymous"   # anonymously triggered jobs may run jobs on agents - which jobs will be part of project authz
        - "Agent/Build:authenticated"   # anonymously triggered jobs may run
  securityRealm:
    # see docs: https://github.com/jenkinsci/configuration-as-code-plugin/tree/master/demos/saml
    saml:
      binding: "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
      displayNameAttributeName: "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"
      emailAttributeName: "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"
      groupsAttributeName: "http://schemas.xmlsoap.org/claims/Group"
      idpMetadataConfiguration:
        # refresh period is in minutes
        period: 60
        url: "${SAML_METADATA_URL:-https://sts.vbc.ac.at/federationmetadata/2007-06/federationmetadata.xml}"
      maximumAuthenticationLifetime: 86400
      usernameCaseConversion: "none"
  remotingSecurity:
    enabled: true
  crumbIssuer:
    standard:
      excludeClientIPFromCrumb: false
  nodes:
    - permanent:
        labelString: "clip docker rhel7"
        launcher:
          ssh: &ssh_launcher
            credentialsId: "jenkins-nodes-ssh-key"
            launchTimeoutSeconds: 210
            maxNumRetries: 10
            port: 22
            retryWaitTime: 15
            # sshHostKeyVerificationStrategy: "nonVerifyingKeyVerificationStrategy"
            sshHostKeyVerificationStrategy: "knownHostsFileKeyVerificationStrategy"
            host: "it-build-clip-1.vbc.ac.at"
        name: "it-build-clip-1"
        nodeDescription: "build clip container images"
        numExecutors: 8
        remoteFS: "/srv/jenkins"
        retentionStrategy: "always"
    - permanent:
        labelString: "rhel8 docker dockerce"
        launcher:
          ssh:
            <<: *ssh_launcher
            host: "it-builder-1.vbc.ac.at"
        name: "it-builder-1"
        nodeDescription: "build all the things"
        numExecutors: 8
        remoteFS: "/srv/jenkins"
        retentionStrategy: "always"
    - permanent:
        labelString: "rhel8 docker dockerce"
        launcher:
          ssh:
            <<: *ssh_launcher
            host: "it-builder-2.vbc.ac.at"
        name: "it-builder-2"
        nodeDescription: "build all the things"
        numExecutors: 8
        remoteFS: "/srv/jenkins"
        retentionStrategy: "always"
  primaryView:
    all:
      name: "All"
  views:
    - list:
        columns:
          - "status"
          - "weather"
          - "jobName"
          - "lastSuccess"
          - "lastFailure"
          - "lastDuration"
          - "buildButton"
          - "favoriteColumn"
        includeRegex: "it/.*role.*"
        jobFilters:
          - regExJobFilter:
              includeExcludeTypeString: "includeMatched"
              matchDisplayName: false
              matchFullDisplayName: false
              matchFullName: false
              matchName: true
              regex: "linux-baseline"
              valueTypeString: "NAME"
          - jobTypeFilter:
              includeExcludeTypeString: "excludeUnmatched"
              jobType: "org.jenkinsci.plugins.workflow.job.WorkflowJob$DescriptorImpl@794d964a"
          - mostRecentJobsFilter:
              checkStartTime: false
              maxToInclude: 30
        name: "Ansible roles"
        recurse: true
    - all:
        name: "all"
    - list:
        columns:
          - "status"
          - "weather"
          - "jobName"
          - "lastFailure"
          - "lastDuration"
          - "buildButton"
          - "favoriteColumn"
        jobFilters:
          - "allJobsFilter"
          - jobTypeFilter:
              includeExcludeTypeString: "excludeUnmatched"
              jobType: "org.jenkinsci.plugins.workflow.job.WorkflowJob$DescriptorImpl@794d964a"
          - buildTrendFilter:
              amount: 0.0
              amountTypeString: "Hours"
              buildCountTypeString: "Latest"
              includeExcludeTypeString: "excludeUnmatched"
              statusTypeString: "NotStable"
        name: "failing jobs"
        recurse: true
    - list:
        columns:
          - "status"
          - "weather"
          - "jobName"
          - "lastSuccess"
          - "lastFailure"
          - "lastDuration"
          - "buildButton"
          - "favoriteColumn"
        includeRegex: ".*"
        jobFilters:
          - "allJobsFilter"
          - "favoriteFilter"
        name: "favorite jobs"
        recurse: true
    - list:
        columns:
        - "status"
        - "weather"
        - "jobName"
        - "lastSuccess"
        - "lastFailure"
        - "lastDuration"
        - "buildButton"
        - "favoriteColumn"
        includeRegex: ".*image.*"
        jobFilters:
        - jobTypeFilter:
            includeExcludeTypeString: "excludeUnmatched"
            jobType: "org.jenkinsci.plugins.workflow.job.WorkflowJob$DescriptorImpl@794d964a"
        - mostRecentJobsFilter:
            checkStartTime: false
            maxToInclude: 30
        name: "image builds"
        recurse: true
    - list:
        columns:
          - "status"
          - "weather"
          - "jobName"
          - "lastSuccess"
          - "lastFailure"
          - "lastDuration"
          - "buildButton"
          - "favoriteColumn"
        jobFilters:
          - "allJobsFilter"
          - userRelevanceFilter:
              amount: 0.0
              amountTypeString: "Hours"
              buildCountTypeString: "Latest"
              ignoreCase: true
              ignoreNonAlphaNumeric: true
              ignoreWhitespace: true
              includeExcludeTypeString: "excludeUnmatched"
              matchBuilder: true
              matchEmail: true
              matchScmChanges: true
              matchUserFullName: true
              matchUserId: true
        name: "my recent builds"
        recurse: true
        statusFilter: true
  viewsTabBar: "standard"
...
